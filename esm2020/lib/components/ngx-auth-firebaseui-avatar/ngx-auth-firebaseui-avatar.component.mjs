import { Component, EventEmitter, Input, Output } from "@angular/core";
import { take } from 'rxjs/operators';
import { UserComponent } from "../ngx-auth-firebaseui-user/user.component";
import * as i0 from "@angular/core";
import * as i1 from "@angular/fire/compat/auth";
import * as i2 from "@angular/material/dialog";
import * as i3 from "../../services/auth-process.service";
import * as i4 from "@angular/material/button";
import * as i5 from "@angular/material/menu";
import * as i6 from "@angular/material/icon";
import * as i7 from "@angular/common";
import * as i8 from "@angular/material/tooltip";
import * as i9 from "@angular/flex-layout/flex";
import * as i10 from "@angular/flex-layout/extended";
import * as i11 from "@angular/material/card";
export class NgxAuthFirebaseuiAvatarComponent {
    constructor(afa, dialog, authProcess) {
        this.afa = afa;
        this.dialog = dialog;
        this.authProcess = authProcess;
        this.layout = "default";
        this.canLogout = true;
        this.canViewAccount = true;
        this.canDeleteAccount = true;
        this.canEditAccount = true;
        this.textProfile = "Profile";
        this.textSignOut = "Sign Out";
        // eslint-disable-next-line @angular-eslint/no-output-on-prefix
        this.onSignOut = new EventEmitter();
    }
    ngOnInit() {
        this.user$ = this.afa.user;
        this.user$.subscribe((user) => {
            this.user = user;
            this.displayNameInitials = user
                ? this.getDisplayNameInitials(user.displayName)
                : null;
        });
    }
    getDisplayNameInitials(displayName) {
        if (!displayName) {
            return null;
        }
        const initialsRegExp = displayName.match(/\b\w/g) || [];
        const initials = ((initialsRegExp.shift() || "") + (initialsRegExp.pop() || "")).toUpperCase();
        return initials;
    }
    openProfile() {
        const dialogRef = this.dialog.open(UserComponent);
        const instance = dialogRef.componentInstance;
        instance.canDeleteAccount = this.canDeleteAccount;
        instance.canEditAccount = this.canEditAccount;
        instance
            .onSignOut
            .pipe(take(1)).subscribe(_ => this.onSignOut.emit()); // propagate the onSignout event
        instance
            .onAccountEdited
            .pipe(take(1)).subscribe(_ => this.displayNameInitials = this.getDisplayNameInitials(this.authProcess.user.displayName)); // update display name initials?
    }
    async signOut() {
        try {
            await this.afa.signOut();
            // Sign-out successful.
            this.onSignOut.emit();
        }
        catch (e) {
            // An error happened.
            console.error("An error happened while signing out!", e);
        }
    }
}
NgxAuthFirebaseuiAvatarComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.2.2", ngImport: i0, type: NgxAuthFirebaseuiAvatarComponent, deps: [{ token: i1.AngularFireAuth }, { token: i2.MatDialog }, { token: i3.AuthProcessService }], target: i0.ɵɵFactoryTarget.Component });
NgxAuthFirebaseuiAvatarComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.2.2", type: NgxAuthFirebaseuiAvatarComponent, selector: "ngx-auth-firebaseui-avatar", inputs: { layout: "layout", canLogout: "canLogout", links: "links", canViewAccount: "canViewAccount", canDeleteAccount: "canDeleteAccount", canEditAccount: "canEditAccount", textProfile: "textProfile", textSignOut: "textSignOut" }, outputs: { onSignOut: "onSignOut" }, ngImport: i0, template: "<button *ngIf=\"user\"\n        class=\"ngx-auth-firebaseui-avatar-button\"\n        [matMenuTriggerFor]=\"posXMenu\"\n        [matTooltip]=\"user?.displayName\"\n        [style.background-image]=\"'url(' + user?.photoURL + ')'\"\n        aria-label=\"Open x-positioned menu\"\n        mat-mini-fab\n        style=\"background-size: cover\">\n  <span *ngIf=\"!user?.photoURL\">{{displayNameInitials || ''}}</span>\n</button>\n\n<mat-menu #posXMenu=\"matMenu\" class=\"before ngx-auth-firebaseui-avatar-menu\" xPosition=\"before\" >\n  <div fxLayout=\"row\" fxLayout.xs=\"column\" style=\"padding-left: 10px; padding-right: 10px\" [ngStyle]=\"{ 'padding-top.px': layout === 'default' ? 0 : 10 }\">\n    <button [style.background-image]=\"user?.photoURL ? 'url(' + user?.photoURL + ')' : ''\"\n            mat-fab\n            style=\"background-size: cover\"\n            *ngIf=\"layout === 'default'\">\n      <span *ngIf=\"!user?.photoURL\">{{displayNameInitials || ''}}</span>\n    </button>\n    <div fxLayout=\"column\" style=\"padding-left: 10px; padding-right: 10px\">\n      <strong mat-card-title>{{user?.displayName}}</strong>\n      <em mat-card-subtitle style=\"font-style: italic\">{{user?.email}}</em>\n    </div>\n  </div>\n\n  <div fxFlex=\"100\" fxLayout=\"column\" [ngStyle]=\"{ 'padding-bottom.px': layout === 'default' ? 0 : 10 } \">\n    <div *ngFor=\"let menuItem of links\" class=\"links-menu\">\n      <button (click)=\"menuItem?.callback()\" mat-menu-item>\n        <mat-icon>{{menuItem?.icon}}</mat-icon>\n        {{menuItem?.text}}</button>\n    </div>\n    <button *ngIf=\"canViewAccount\" (click)=\"openProfile()\" color=\"primary\" fxLayoutAlign=\"center\" mat-raised-button>{{ textProfile }}\n    </button>\n    <button (click)=\"signOut()\" *ngIf=\"canLogout\" color=\"warn\" fxLayoutAlign=\"center\" mat-raised-button>{{ textSignOut }}\n    </button>\n  </div>\n</mat-menu>\n", styles: [".mat-raised-button{margin:.2rem 1rem}.links-menu{text-align:center}\n"], components: [{ type: i4.MatButton, selector: "button[mat-button], button[mat-raised-button], button[mat-icon-button],             button[mat-fab], button[mat-mini-fab], button[mat-stroked-button],             button[mat-flat-button]", inputs: ["disabled", "disableRipple", "color"], exportAs: ["matButton"] }, { type: i5.MatMenu, selector: "mat-menu", exportAs: ["matMenu"] }, { type: i5.MatMenuItem, selector: "[mat-menu-item]", inputs: ["disabled", "disableRipple", "role"], exportAs: ["matMenuItem"] }, { type: i6.MatIcon, selector: "mat-icon", inputs: ["color", "inline", "svgIcon", "fontSet", "fontIcon"], exportAs: ["matIcon"] }], directives: [{ type: i7.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i5.MatMenuTrigger, selector: "[mat-menu-trigger-for], [matMenuTriggerFor]", exportAs: ["matMenuTrigger"] }, { type: i8.MatTooltip, selector: "[matTooltip]", exportAs: ["matTooltip"] }, { type: i9.DefaultLayoutDirective, selector: "  [fxLayout], [fxLayout.xs], [fxLayout.sm], [fxLayout.md],  [fxLayout.lg], [fxLayout.xl], [fxLayout.lt-sm], [fxLayout.lt-md],  [fxLayout.lt-lg], [fxLayout.lt-xl], [fxLayout.gt-xs], [fxLayout.gt-sm],  [fxLayout.gt-md], [fxLayout.gt-lg]", inputs: ["fxLayout", "fxLayout.xs", "fxLayout.sm", "fxLayout.md", "fxLayout.lg", "fxLayout.xl", "fxLayout.lt-sm", "fxLayout.lt-md", "fxLayout.lt-lg", "fxLayout.lt-xl", "fxLayout.gt-xs", "fxLayout.gt-sm", "fxLayout.gt-md", "fxLayout.gt-lg"] }, { type: i7.NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }, { type: i10.DefaultStyleDirective, selector: "  [ngStyle],  [ngStyle.xs], [ngStyle.sm], [ngStyle.md], [ngStyle.lg], [ngStyle.xl],  [ngStyle.lt-sm], [ngStyle.lt-md], [ngStyle.lt-lg], [ngStyle.lt-xl],  [ngStyle.gt-xs], [ngStyle.gt-sm], [ngStyle.gt-md], [ngStyle.gt-lg]", inputs: ["ngStyle", "ngStyle.xs", "ngStyle.sm", "ngStyle.md", "ngStyle.lg", "ngStyle.xl", "ngStyle.lt-sm", "ngStyle.lt-md", "ngStyle.lt-lg", "ngStyle.lt-xl", "ngStyle.gt-xs", "ngStyle.gt-sm", "ngStyle.gt-md", "ngStyle.gt-lg"] }, { type: i11.MatCardTitle, selector: "mat-card-title, [mat-card-title], [matCardTitle]" }, { type: i11.MatCardSubtitle, selector: "mat-card-subtitle, [mat-card-subtitle], [matCardSubtitle]" }, { type: i9.DefaultFlexDirective, selector: "  [fxFlex], [fxFlex.xs], [fxFlex.sm], [fxFlex.md],  [fxFlex.lg], [fxFlex.xl], [fxFlex.lt-sm], [fxFlex.lt-md],  [fxFlex.lt-lg], [fxFlex.lt-xl], [fxFlex.gt-xs], [fxFlex.gt-sm],  [fxFlex.gt-md], [fxFlex.gt-lg]", inputs: ["fxFlex", "fxFlex.xs", "fxFlex.sm", "fxFlex.md", "fxFlex.lg", "fxFlex.xl", "fxFlex.lt-sm", "fxFlex.lt-md", "fxFlex.lt-lg", "fxFlex.lt-xl", "fxFlex.gt-xs", "fxFlex.gt-sm", "fxFlex.gt-md", "fxFlex.gt-lg"] }, { type: i7.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { type: i9.DefaultLayoutAlignDirective, selector: "  [fxLayoutAlign], [fxLayoutAlign.xs], [fxLayoutAlign.sm], [fxLayoutAlign.md],  [fxLayoutAlign.lg], [fxLayoutAlign.xl], [fxLayoutAlign.lt-sm], [fxLayoutAlign.lt-md],  [fxLayoutAlign.lt-lg], [fxLayoutAlign.lt-xl], [fxLayoutAlign.gt-xs], [fxLayoutAlign.gt-sm],  [fxLayoutAlign.gt-md], [fxLayoutAlign.gt-lg]", inputs: ["fxLayoutAlign", "fxLayoutAlign.xs", "fxLayoutAlign.sm", "fxLayoutAlign.md", "fxLayoutAlign.lg", "fxLayoutAlign.xl", "fxLayoutAlign.lt-sm", "fxLayoutAlign.lt-md", "fxLayoutAlign.lt-lg", "fxLayoutAlign.lt-xl", "fxLayoutAlign.gt-xs", "fxLayoutAlign.gt-sm", "fxLayoutAlign.gt-md", "fxLayoutAlign.gt-lg"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.2.2", ngImport: i0, type: NgxAuthFirebaseuiAvatarComponent, decorators: [{
            type: Component,
            args: [{ selector: "ngx-auth-firebaseui-avatar", template: "<button *ngIf=\"user\"\n        class=\"ngx-auth-firebaseui-avatar-button\"\n        [matMenuTriggerFor]=\"posXMenu\"\n        [matTooltip]=\"user?.displayName\"\n        [style.background-image]=\"'url(' + user?.photoURL + ')'\"\n        aria-label=\"Open x-positioned menu\"\n        mat-mini-fab\n        style=\"background-size: cover\">\n  <span *ngIf=\"!user?.photoURL\">{{displayNameInitials || ''}}</span>\n</button>\n\n<mat-menu #posXMenu=\"matMenu\" class=\"before ngx-auth-firebaseui-avatar-menu\" xPosition=\"before\" >\n  <div fxLayout=\"row\" fxLayout.xs=\"column\" style=\"padding-left: 10px; padding-right: 10px\" [ngStyle]=\"{ 'padding-top.px': layout === 'default' ? 0 : 10 }\">\n    <button [style.background-image]=\"user?.photoURL ? 'url(' + user?.photoURL + ')' : ''\"\n            mat-fab\n            style=\"background-size: cover\"\n            *ngIf=\"layout === 'default'\">\n      <span *ngIf=\"!user?.photoURL\">{{displayNameInitials || ''}}</span>\n    </button>\n    <div fxLayout=\"column\" style=\"padding-left: 10px; padding-right: 10px\">\n      <strong mat-card-title>{{user?.displayName}}</strong>\n      <em mat-card-subtitle style=\"font-style: italic\">{{user?.email}}</em>\n    </div>\n  </div>\n\n  <div fxFlex=\"100\" fxLayout=\"column\" [ngStyle]=\"{ 'padding-bottom.px': layout === 'default' ? 0 : 10 } \">\n    <div *ngFor=\"let menuItem of links\" class=\"links-menu\">\n      <button (click)=\"menuItem?.callback()\" mat-menu-item>\n        <mat-icon>{{menuItem?.icon}}</mat-icon>\n        {{menuItem?.text}}</button>\n    </div>\n    <button *ngIf=\"canViewAccount\" (click)=\"openProfile()\" color=\"primary\" fxLayoutAlign=\"center\" mat-raised-button>{{ textProfile }}\n    </button>\n    <button (click)=\"signOut()\" *ngIf=\"canLogout\" color=\"warn\" fxLayoutAlign=\"center\" mat-raised-button>{{ textSignOut }}\n    </button>\n  </div>\n</mat-menu>\n", styles: [".mat-raised-button{margin:.2rem 1rem}.links-menu{text-align:center}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.AngularFireAuth }, { type: i2.MatDialog }, { type: i3.AuthProcessService }]; }, propDecorators: { layout: [{
                type: Input
            }], canLogout: [{
                type: Input
            }], links: [{
                type: Input
            }], canViewAccount: [{
                type: Input
            }], canDeleteAccount: [{
                type: Input
            }], canEditAccount: [{
                type: Input
            }], textProfile: [{
                type: Input
            }], textSignOut: [{
                type: Input
            }], onSignOut: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWF1dGgtZmlyZWJhc2V1aS1hdmF0YXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LWF1dGgtZmlyZWJhc2V1aS9zcmMvbGliL2NvbXBvbmVudHMvbmd4LWF1dGgtZmlyZWJhc2V1aS1hdmF0YXIvbmd4LWF1dGgtZmlyZWJhc2V1aS1hdmF0YXIuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LWF1dGgtZmlyZWJhc2V1aS9zcmMvbGliL2NvbXBvbmVudHMvbmd4LWF1dGgtZmlyZWJhc2V1aS1hdmF0YXIvbmd4LWF1dGgtZmlyZWJhc2V1aS1hdmF0YXIuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFVLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUkvRSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFdEMsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLDRDQUE0QyxDQUFDOzs7Ozs7Ozs7Ozs7O0FBZTNFLE1BQU0sT0FBTyxnQ0FBZ0M7SUFpQzNDLFlBQW1CLEdBQW9CLEVBQVMsTUFBaUIsRUFBVSxXQUErQjtRQUF2RixRQUFHLEdBQUgsR0FBRyxDQUFpQjtRQUFTLFdBQU0sR0FBTixNQUFNLENBQVc7UUFBVSxnQkFBVyxHQUFYLFdBQVcsQ0FBb0I7UUEvQjFHLFdBQU0sR0FBeUIsU0FBUyxDQUFDO1FBR3pDLGNBQVMsR0FBRyxJQUFJLENBQUM7UUFNakIsbUJBQWMsR0FBRyxJQUFJLENBQUM7UUFHdEIscUJBQWdCLEdBQUcsSUFBSSxDQUFDO1FBR3hCLG1CQUFjLEdBQUcsSUFBSSxDQUFDO1FBR3RCLGdCQUFXLEdBQUcsU0FBUyxDQUFDO1FBR3hCLGdCQUFXLEdBQUcsVUFBVSxDQUFDO1FBRXpCLCtEQUErRDtR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IEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uSW5pdCwgT3V0cHV0IH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IEFuZ3VsYXJGaXJlQXV0aCB9IGZyb20gXCJAYW5ndWxhci9maXJlL2NvbXBhdC9hdXRoXCI7XG5pbXBvcnQgZmlyZWJhc2UgZnJvbSBcImZpcmViYXNlL2NvbXBhdC9hcHBcIjtcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tIFwicnhqc1wiO1xuaW1wb3J0IHsgdGFrZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE1hdERpYWxvZyB9IGZyb20gXCJAYW5ndWxhci9tYXRlcmlhbC9kaWFsb2dcIjtcbmltcG9ydCB7IFVzZXJDb21wb25lbnQgfSBmcm9tIFwiLi4vbmd4LWF1dGgtZmlyZWJhc2V1aS11c2VyL3VzZXIuY29tcG9uZW50XCI7XG5pbXBvcnQgeyBBdXRoUHJvY2Vzc1NlcnZpY2UgfSBmcm9tIFwiLi4vLi4vc2VydmljZXMvYXV0aC1wcm9jZXNzLnNlcnZpY2VcIjtcblxuZXhwb3J0IGludGVyZmFjZSBMaW5rTWVudUl0ZW0ge1xuICB0ZXh0OiBzdHJpbmc7XG4gIGljb24/OiBzdHJpbmc7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXR5cGVzXG4gIGNhbGxiYWNrPzogRnVuY3Rpb247XG59XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogXCJuZ3gtYXV0aC1maXJlYmFzZXVpLWF2YXRhclwiLFxuICB0ZW1wbGF0ZVVybDogXCIuL25neC1hdXRoLWZpcmViYXNldWktYXZhdGFyLmNvbXBvbmVudC5odG1sXCIsXG4gIHN0eWxlVXJsczogW1wiLi9uZ3gtYXV0aC1maXJlYmFzZXVpLWF2YXRhci5jb21wb25lbnQuc2Nzc1wiXSxcbn0pXG5leHBvcnQgY2xhc3MgTmd4QXV0aEZpcmViYXNldWlBdmF0YXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICBASW5wdXQoKVxuICBsYXlvdXQ6IFwiZGVmYXVsdFwiIHwgXCJzaW1wbGVcIiA9IFwiZGVmYXVsdFwiO1xuXG4gIEBJbnB1dCgpXG4gIGNhbkxvZ291dCA9IHRydWU7XG5cbiAgQElucHV0KClcbiAgbGlua3M6IExpbmtNZW51SXRlbVtdO1xuXG4gIEBJbnB1dCgpXG4gIGNhblZpZXdBY2NvdW50ID0gdHJ1ZTtcblxuICBASW5wdXQoKVxuICBjYW5EZWxldGVBY2NvdW50ID0gdHJ1ZTtcblxuICBASW5wdXQoKVxuICBjYW5FZGl0QWNjb3VudCA9IHRydWU7XG5cbiAgQElucHV0KClcbiAgdGV4dFByb2ZpbGUgPSBcIlByb2ZpbGVcIjtcblxuICBASW5wdXQoKVxuICB0ZXh0U2lnbk91dCA9IFwiU2lnbiBPdXRcIjtcblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQGFuZ3VsYXItZXNsaW50L25vLW91dHB1dC1vbi1wcmVmaXhcbiAgQE91dHB1dCgpXG4gIG9uU2lnbk91dDogRXZlbnRFbWl0dGVyPHZvaWQ+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIHVzZXI6IGZpcmViYXNlLlVzZXI7XG4gIHVzZXIkOiBPYnNlcnZhYmxlPGZpcmViYXNlLlVzZXIgfCBudWxsPjtcbiAgZGlzcGxheU5hbWVJbml0aWFsczogc3RyaW5nIHwgbnVsbDtcblxuICBjb25zdHJ1Y3RvcihwdWJsaWMgYWZhOiBBbmd1bGFyRmlyZUF1dGgsIHB1YmxpYyBkaWFsb2c6IE1hdERpYWxvZywgcHJpdmF0ZSBhdXRoUHJvY2VzczogQXV0aFByb2Nlc3NTZXJ2aWNlKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMudXNlciQgPSB0aGlzLmFmYS51c2VyO1xuICAgIHRoaXMudXNlciQuc3Vic2NyaWJlKCh1c2VyOiBmaXJlYmFzZS5Vc2VyKSA9PiB7XG4gICAgICB0aGlzLnVzZXIgPSB1c2VyO1xuICAgICAgdGhpcy5kaXNwbGF5TmFtZUluaXRpYWxzID0gdXNlclxuICAgICAgICA/IHRoaXMuZ2V0RGlzcGxheU5hbWVJbml0aWFscyh1c2VyLmRpc3BsYXlOYW1lKVxuICAgICAgICA6IG51bGw7XG4gICAgfSk7XG4gIH1cblxuICBnZXREaXNwbGF5TmFtZUluaXRpYWxzKGRpc3BsYXlOYW1lOiBzdHJpbmcgfCBudWxsKTogc3RyaW5nIHwgbnVsbCB7XG4gICAgaWYgKCFkaXNwbGF5TmFtZSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGluaXRpYWxzUmVnRXhwOiBSZWdFeHBNYXRjaEFycmF5ID0gZGlzcGxheU5hbWUubWF0Y2goL1xcYlxcdy9nKSB8fCBbXTtcbiAgICBjb25zdCBpbml0aWFscyA9IChcbiAgICAgIChpbml0aWFsc1JlZ0V4cC5zaGlmdCgpIHx8IFwiXCIpICsgKGluaXRpYWxzUmVnRXhwLnBvcCgpIHx8IFwiXCIpXG4gICAgKS50b1VwcGVyQ2FzZSgpO1xuICAgIHJldHVybiBpbml0aWFscztcbiAgfVxuXG4gIG9wZW5Qcm9maWxlKCkge1xuICAgIGNvbnN0IGRpYWxvZ1JlZiA9IHRoaXMuZGlhbG9nLm9wZW4oIFVzZXJDb21wb25lbnQpO1xuICAgIGNvbnN0IGluc3RhbmNlID0gZGlhbG9nUmVmLmNvbXBvbmVudEluc3RhbmNlO1xuICAgIGluc3RhbmNlLmNhbkRlbGV0ZUFjY291bnQgPSB0aGlzLmNhbkRlbGV0ZUFjY291bnQ7XG4gICAgaW5zdGFuY2UuY2FuRWRpdEFjY291bnQgPSB0aGlzLmNhbkVkaXRBY2NvdW50O1xuICAgIGluc3RhbmNlXG4gICAgLm9uU2lnbk91dFxuICAgIC5waXBlKFxuICAgICAgdGFrZSgxKVxuICAgICAgKS5zdWJzY3JpYmUoXyA9PiB0aGlzLm9uU2lnbk91dC5lbWl0KCkpOyAvLyBwcm9wYWdhdGUgdGhlIG9uU2lnbm91dCBldmVudFxuICAgIGluc3RhbmNlXG4gICAgLm9uQWNjb3VudEVkaXRlZFxuICAgIC5waXBlKFxuICAgICAgdGFrZSgxKVxuICAgICkuc3Vic2NyaWJlKF8gPT4gdGhpcy5kaXNwbGF5TmFtZUluaXRpYWxzID0gdGhpcy5nZXREaXNwbGF5TmFtZUluaXRpYWxzKHRoaXMuYXV0aFByb2Nlc3MudXNlci5kaXNwbGF5TmFtZSkpIC8vIHVwZGF0ZSBkaXNwbGF5IG5hbWUgaW5pdGlhbHM/XG4gIH1cblxuICBhc3luYyBzaWduT3V0KCkge1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLmFmYS5zaWduT3V0KCk7XG4gICAgICAvLyBTaWduLW91dCBzdWNjZXNzZnVsLlxuICAgICAgdGhpcy5vblNpZ25PdXQuZW1pdCgpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIC8vIEFuIGVycm9yIGhhcHBlbmVkLlxuICAgICAgY29uc29sZS5lcnJvcihcIkFuIGVycm9yIGhhcHBlbmVkIHdoaWxlIHNpZ25pbmcgb3V0IVwiLCBlKTtcbiAgICB9XG4gIH1cbn1cbiIsIjxidXR0b24gKm5nSWY9XCJ1c2VyXCJcbiAgICAgICAgY2xhc3M9XCJuZ3gtYXV0aC1maXJlYmFzZXVpLWF2YXRhci1idXR0b25cIlxuICAgICAgICBbbWF0TWVudVRyaWdnZXJGb3JdPVwicG9zWE1lbnVcIlxuICAgICAgICBbbWF0VG9vbHRpcF09XCJ1c2VyPy5kaXNwbGF5TmFtZVwiXG4gICAgICAgIFtzdHlsZS5iYWNrZ3JvdW5kLWltYWdlXT1cIid1cmwoJyArIHVzZXI/LnBob3RvVVJMICsgJyknXCJcbiAgICAgICAgYXJpYS1sYWJlbD1cIk9wZW4geC1wb3NpdGlvbmVkIG1lbnVcIlxuICAgICAgICBtYXQtbWluaS1mYWJcbiAgICAgICAgc3R5bGU9XCJiYWNrZ3JvdW5kLXNpemU6IGNvdmVyXCI+XG4gIDxzcGFuICpuZ0lmPVwiIXVzZXI/LnBob3RvVVJMXCI+e3tkaXNwbGF5TmFtZUluaXRpYWxzIHx8ICcnfX08L3NwYW4+XG48L2J1dHRvbj5cblxuPG1hdC1tZW51ICNwb3NYTWVudT1cIm1hdE1lbnVcIiBjbGFzcz1cImJlZm9yZSBuZ3gtYXV0aC1maXJlYmFzZXVpLWF2YXRhci1tZW51XCIgeFBvc2l0aW9uPVwiYmVmb3JlXCIgPlxuICA8ZGl2IGZ4TGF5b3V0PVwicm93XCIgZnhMYXlvdXQueHM9XCJjb2x1bW5cIiBzdHlsZT1cInBhZGRpbmctbGVmdDogMTBweDsgcGFkZGluZy1yaWdodDogMTBweFwiIFtuZ1N0eWxlXT1cInsgJ3BhZGRpbmctdG9wLnB4JzogbGF5b3V0ID09PSAnZGVmYXVsdCcgPyAwIDogMTAgfVwiPlxuICAgIDxidXR0b24gW3N0eWxlLmJhY2tncm91bmQtaW1hZ2VdPVwidXNlcj8ucGhvdG9VUkwgPyAndXJsKCcgKyB1c2VyPy5waG90b1VSTCArICcpJyA6ICcnXCJcbiAgICAgICAgICAgIG1hdC1mYWJcbiAgICAgICAgICAgIHN0eWxlPVwiYmFja2dyb3VuZC1zaXplOiBjb3ZlclwiXG4gICAgICAgICAgICAqbmdJZj1cImxheW91dCA9PT0gJ2RlZmF1bHQnXCI+XG4gICAgICA8c3BhbiAqbmdJZj1cIiF1c2VyPy5waG90b1VSTFwiPnt7ZGlzcGxheU5hbWVJbml0aWFscyB8fCAnJ319PC9zcGFuPlxuICAgIDwvYnV0dG9uPlxuICAgIDxkaXYgZnhMYXlvdXQ9XCJjb2x1bW5cIiBzdHlsZT1cInBhZGRpbmctbGVmdDogMTBweDsgcGFkZGluZy1yaWdodDogMTBweFwiPlxuICAgICAgPHN0cm9uZyBtYXQtY2FyZC10aXRsZT57e3VzZXI/LmRpc3BsYXlOYW1lfX08L3N0cm9uZz5cbiAgICAgIDxlbSBtYXQtY2FyZC1zdWJ0aXRsZSBzdHlsZT1cImZvbnQtc3R5bGU6IGl0YWxpY1wiPnt7dXNlcj8uZW1haWx9fTwvZW0+XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuXG4gIDxkaXYgZnhGbGV4PVwiMTAwXCIgZnhMYXlvdXQ9XCJjb2x1bW5cIiBbbmdTdHlsZV09XCJ7ICdwYWRkaW5nLWJvdHRvbS5weCc6IGxheW91dCA9PT0gJ2RlZmF1bHQnID8gMCA6IDEwIH0gXCI+XG4gICAgPGRpdiAqbmdGb3I9XCJsZXQgbWVudUl0ZW0gb2YgbGlua3NcIiBjbGFzcz1cImxpbmtzLW1lbnVcIj5cbiAgICAgIDxidXR0b24gKGNsaWNrKT1cIm1lbnVJdGVtPy5jYWxsYmFjaygpXCIgbWF0LW1lbnUtaXRlbT5cbiAgICAgICAgPG1hdC1pY29uPnt7bWVudUl0ZW0/Lmljb259fTwvbWF0LWljb24+XG4gICAgICAgIHt7bWVudUl0ZW0/LnRleHR9fTwvYnV0dG9uPlxuICAgIDwvZGl2PlxuICAgIDxidXR0b24gKm5nSWY9XCJjYW5WaWV3QWNjb3VudFwiIChjbGljayk9XCJvcGVuUHJvZmlsZSgpXCIgY29sb3I9XCJwcmltYXJ5XCIgZnhMYXlvdXRBbGlnbj1cImNlbnRlclwiIG1hdC1yYWlzZWQtYnV0dG9uPnt7IHRleHRQcm9maWxlIH19XG4gICAgPC9idXR0b24+XG4gICAgPGJ1dHRvbiAoY2xpY2spPVwic2lnbk91dCgpXCIgKm5nSWY9XCJjYW5Mb2dvdXRcIiBjb2xvcj1cIndhcm5cIiBmeExheW91dEFsaWduPVwiY2VudGVyXCIgbWF0LXJhaXNlZC1idXR0b24+e3sgdGV4dFNpZ25PdXQgfX1cbiAgICA8L2J1dHRvbj5cbiAgPC9kaXY+XG48L21hdC1tZW51PlxuIl19